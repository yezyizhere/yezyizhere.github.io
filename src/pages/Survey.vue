<script setup>
import Header from '@/layout/Header.vue'
import { ref, computed } from 'vue'

const pageIndex = ref(0)

const onequestions = [{ text: 'ë°¥ë³´ë‹¤ ê°„ì‹ì„ ë” ë¨¹ëŠ”ê±° ê°™ë‹¤' }, { text: 'ë‚˜ëŠ” ê°•ë ¬í•œ ëŒ„ìŠ¤ë¥¼ ë³´ê³ ì‹¶ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ì†Œí†µì´ ë§ë‹¤' }, { text: 'ë‚˜ëŠ” ê³ ì–‘ì´ìƒì´ ì¢‹ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ì†ì´ ê¹Šë‹¤' }]
const twoquestions = [{ text: 'ë‚´ ìµœì• ëŠ” ê°•ì•„ì§€ë¥¼ ë§¤ìš° ì¢‹ì•„í•œë‹¤' }, { text: 'ë‚˜ëŠ” ê°•ì•„ì§€ìƒì´ ì¢‹ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ê¹»ìì„ ì‹«ì–´í• ê±°ê°™ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ê²Œì„ì„ ëª»í•œë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ê¸°ê³„ì¹˜ì¸ê±°ê°™ë‹¤' }]
const threequestions = [{ text: 'ë‚´ ìµœì• ëŠ” ë°°ìš°ìƒì´ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ì‹œë‹ˆì»¬í•˜ë‹¤' }, { text: 'ë‚˜ëŠ” ë“œë¼ë§ˆë¥¼ ë§ì´ ë³¸ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ì¸ë§¥ì´ ë„“ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ë²Œë ˆë¥¼ ë¬´ì„œì›Œí•œë‹¤' }]
const fourquestions = [{ text: 'ë‚´ ìµœì• ëŠ” ë©ë•Œë¦¬ê¸° ì¥ì¸ì´ë‹¤' }, { text: 'ë‚˜ëŠ” ë¶€ë“œëŸ¬ìš´ ì¶¤ì„ ì„ ì„ í˜¸í•œë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ìƒˆë¥¼ ë¬´ì„œì›Œí•œë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ë¶€ì§€ëŸ°í•˜ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ê³ ì†Œê³µí¬ì¦ì´ ìˆë‹¤' }]
const fivequestions = [{ text: 'ë‚´ ìµœì• ëŠ” ëˆˆì´ í¬ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” í‚¤ê°€ í¬ë‹¤' }, { text: 'ë‚´ ìµœì• ëŠ” ë¨¹ëŠ”ê²ƒì„ ì¢‹ì•„í•œë‹¤' }, { text: 'ë‚˜ëŠ” ë´‰ì§€ë¼ë©´ë³´ë‹¨ ì»µë¼ë©´ì„ ë” ì¢‹ì•„í•œë‹¤' }, { text: 'ë‚˜ëŠ” ì• êµ ë§ì€ ì‚¬ëŒì´ ì¢‹ë‹¤' }]

const answers1 = ref(Array(onequestions.length).fill(null))
const answers2 = ref(Array(twoquestions.length).fill(null))
const answers3 = ref(Array(threequestions.length).fill(null))
const answers4 = ref(Array(fourquestions.length).fill(null))
const answers5 = ref(Array(fivequestions.length).fill(null))

const onescore = ref(0)
const twoscore = ref(0)
const threescore = ref(0)
const fourscore = ref(0)
const fivescore = ref(0)

function setActive(idx) {
  if (pageIndex.value === 1 && idx === 2) {
    onescore.value = answers1.value.reduce((acc, cur) => acc + (Number(cur) || 0), 0)
  }
  if (pageIndex.value === 2 && idx === 3) {
    twoscore.value = answers2.value.reduce((acc, cur) => acc + (Number(cur) || 0), 0)
  }
  if (pageIndex.value === 3 && idx === 4) {
    threescore.value = answers3.value.reduce((acc, cur) => acc + (Number(cur) || 0), 0)
  }
  if (pageIndex.value === 4 && idx === 5) {
    fourscore.value = answers4.value.reduce((acc, cur) => acc + (Number(cur) || 0), 0)
  }
  if (pageIndex.value === 5 && idx === 6) {
    fivescore.value = answers5.value.reduce((acc, cur) => acc + (Number(cur) || 0), 0)
  }
  pageIndex.value = idx
}

const memberNames = ['ì˜ˆì§€', 'ë¦¬ì•„', 'ë¥˜ì§„', 'ì±„ë ¹', 'ìœ ë‚˜']
const memberScores = computed(() => [onescore.value, twoscore.value, threescore.value, fourscore.value, fivescore.value])
const memberPercents = computed(() => memberScores.value.map((score) => Math.round((score / 25) * 100)))

// ìµœê³ ì  ì°¾ê¸°
const maxScore = computed(() => Math.max(...memberScores.value))
// ITZY ìˆœì„œëŒ€ë¡œ ë™ì  ë©¤ë²„ ì¶”ì¶œ
const topMembers = computed(() => memberNames.filter((_, i) => memberScores.value[i] === maxScore.value))

// ì¡°í•©ëª…ì¹­ ë§¤í•‘
const pairNames = {
  'ì˜ˆì§€,ë¦¬ì•„': 'ì˜ˆì§€ìˆ˜',
  'ì˜ˆì§€,ë¥˜ì§„': 'ë•¡ë©',
  'ì˜ˆì§€,ì±„ë ¹': 'ë ¹ì§€ê³¤ì§€',
  'ì˜ˆì§€,ìœ ë‚˜': 'ë§ë§‰',
  'ë¦¬ì•„,ë¥˜ì§„': 'ì§„ë¦¬ì•„',
  'ë¦¬ì•„,ì±„ë ¹': 'ì±„ë¦¬ì¦ˆ',
  'ë¦¬ì•„,ìœ ë‚˜': 'ê¶í•©ì¦ˆ',
  'ë¥˜ì§„,ì±„ë ¹': '01ì¦ˆ',
  'ë¥˜ì§„,ìœ ë‚˜': 'ì‹ ìë§¤',
  'ì±„ë ¹,ìœ ë‚˜': 'ìœ ì±„ê½ƒ',
}
const tripleNames = {
  'ì˜ˆì§€,ë¦¬ì•„,ë¥˜ì§„': 'ì˜ˆì§€ìˆ˜ë¥˜',
  'ì˜ˆì§€,ë¥˜ì§„,ì±„ë ¹': 'ìº£ì¦ˆ',
  'ì˜ˆì§€,ë¥˜ì§„,ìœ ë‚˜': 'ë¥®ë©ì‹ ë‚˜',
  'ë¦¬ì•„,ë¥˜ì§„,ì±„ë ¹': 'ë¯¸ë“¤ì¦ˆ',
  'ë¥˜ì§„,ì±„ë ¹,ìœ ë‚˜': 'í•œëŒí€¸ì¹´ì¦ˆ',
}

// ìµœì¢… ë©”ì´íŠ¸ëª… ê²°ì •
const mateName = computed(() => {
  const arr = topMembers.value
  if (arr.length === 1) return arr[0]
  if (arr.length === 2) {
    const key = arr.join(',')
    return pairNames[key] || arr.join(', ')
  }
  if (arr.length === 3) {
    const key = arr.join(',')
    return tripleNames[key] || arr.join(', ')
  }
  if (arr.length === 4) return 'ITZY'
  if (arr.length === 5) return 'ITZY'
  return ''
})

// ìƒˆë¡œê³ ì¹¨
function Refresh() {
  window.location.reload()
}
</script>

<template>
  <section class="bg-neutral-900 min-h-screen h-full text-zinc-200 pb-10">
    <Header />

    <!-- ê¸°ë³¸ í˜ì´ì§€ -->
    <section v-if="pageIndex === 0" class="flex flex-col justify-center items-center min-h-[80vh] px-7">
      <div class="flex flex-col pb-5 items-center">
        <div class="text-2xl text-center md:text-5xl">ë‚˜ë§Œì˜ ìµœì•  ì°¾ê¸°</div>
        <div class="text-sm text-center text-blue-400 mt-2 md:text-xl">ë‹¨ìˆœ ì¬ë¯¸ë¡œ ì°¸ê³ í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤</div>
      </div>

      <div class="text-center">
        <p class="text-blue-400 text-xl md:text-2xl md:mt-15">ã€” ë£° ì„¤ëª… ã€•</p>
        <div class="flex flex-col gap-3 justify-center items-center">
          <p class="mt-5">1. ë³¸ì¸ì˜ ìµœì• ë¥¼ ìƒê°í•˜ì„¸ìš”</p>
          <p>2. ì–¼ë§ˆë‚˜ í•´ë‹¹ë˜ëŠ”ì§€ ì„ íƒí•˜ì„¸ìš”</p>
          <p>1: ì•„ë‹Œê±° ê°™ë‹¤ ~ 5: ë§¤ìš° ê·¸ë ‡ë‹¤</p>

          <button @click="setActive(1)" class="mt-5 p-2 w-20 rounded ring-2">ì‹œì‘</button>
        </div>
      </div>
    </section>

    <!-- 1ë²ˆ í˜ì´ì§€ -->
    <section v-if="pageIndex === 1" class="flex flex-col justify-center items-center min-h-[80vh] px-5 md:px-7 mt-5">
      <div class="w-full max-w-xl space-y-4">
        <div v-for="(question, idx) in onequestions" :key="idx" class="flex items-center justify-between border-b border-zinc-600 py-3">
          <span class="text-base md:text-lg"> {{ idx + 1 }}. {{ question.text }} </span>
          <div class="flex gap-2 md:gap-3">
            <label v-for="score in [1, 2, 3, 4, 5]" :key="score" class="flex flex-col items-center">
              <input type="radio" :name="'q' + idx" :value="score" v-model="answers1[idx]" class="peer hidden" />
              <span class="w-5 h-5 rounded-full border-2 border-blue-400 flex items-center justify-center transition peer-checked:bg-blue-500 peer-checked:border-blue-500 peer-checked:scale-110 cursor-pointer">
                <span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition"></span>
              </span>
              <span class="text-xs mt-1 md:text-sm">{{ score }}</span>
            </label>
          </div>
        </div>
      </div>
      <div class="mt-5 flex justify-end w-full max-w-xl">
        <button @click="setActive(2)" class="p-1 w-20 rounded ring-2">ë‹¤ìŒ</button>
      </div>
    </section>

    <!-- 2ë²ˆ í˜ì´ì§€ -->
    <section v-if="pageIndex === 2" class="flex flex-col justify-center items-center min-h-[80vh] px-5 md:px-7 mt-5">
      <div class="w-full max-w-xl space-y-4">
        <div v-for="(question, idx) in twoquestions" :key="idx" class="flex items-center justify-between border-b border-zinc-600 py-3">
          <span class="text-base md:text-lg"> {{ idx + 1 }}. {{ question.text }} </span>
          <div class="flex gap-2 md:gap-3">
            <label v-for="score in [1, 2, 3, 4, 5]" :key="score" class="flex flex-col items-center">
              <input type="radio" :name="'q' + idx" :value="score" v-model="answers2[idx]" class="peer hidden" />
              <span class="w-5 h-5 rounded-full border-2 border-blue-400 flex items-center justify-center transition peer-checked:bg-blue-500 peer-checked:border-blue-500 peer-checked:scale-110 cursor-pointer">
                <span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition"></span>
              </span>
              <span class="text-xs mt-1 md:text-sm">{{ score }}</span>
            </label>
          </div>
        </div>
      </div>
      <div class="mt-5 flex justify-between w-full max-w-xl">
        <button @click="setActive(1)" class="p-1 w-20 rounded ring-2">ì´ì „</button>
        <button @click="setActive(3)" class="p-1 w-20 rounded ring-2">ë‹¤ìŒ</button>
      </div>
    </section>

    <!-- 3ë²ˆ í˜ì´ì§€ -->
    <section v-if="pageIndex === 3" class="flex flex-col justify-center items-center min-h-[80vh] px-5 md:px-7 mt-5">
      <div class="w-full max-w-xl space-y-4">
        <div v-for="(question, idx) in threequestions" :key="idx" class="flex items-center justify-between border-b border-zinc-600 py-3">
          <span class="text-base md:text-lg"> {{ idx + 1 }}. {{ question.text }} </span>
          <div class="flex gap-2 md:gap-3">
            <label v-for="score in [1, 2, 3, 4, 5]" :key="score" class="flex flex-col items-center">
              <input type="radio" :name="'q' + idx" :value="score" v-model="answers3[idx]" class="peer hidden" />
              <span class="w-5 h-5 rounded-full border-2 border-blue-400 flex items-center justify-center transition peer-checked:bg-blue-500 peer-checked:border-blue-500 peer-checked:scale-110 cursor-pointer">
                <span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition"></span>
              </span>
              <span class="text-xs mt-1 md:text-sm">{{ score }}</span>
            </label>
          </div>
        </div>
      </div>
      <div class="mt-5 flex justify-between w-full max-w-xl">
        <button @click="setActive(2)" class="p-1 w-20 rounded ring-2">ì´ì „</button>
        <button @click="setActive(4)" class="p-1 w-20 rounded ring-2">ë‹¤ìŒ</button>
      </div>
    </section>

    <!-- 4ë²ˆ í˜ì´ì§€ -->
    <section v-if="pageIndex === 4" class="flex flex-col justify-center items-center min-h-[80vh] px-5 md:px-7 mt-5">
      <div class="w-full max-w-xl space-y-4">
        <div v-for="(question, idx) in fourquestions" :key="idx" class="flex items-center justify-between border-b border-zinc-600 py-3">
          <span class="text-base md:text-lg"> {{ idx + 1 }}. {{ question.text }} </span>
          <div class="flex gap-2 md:gap-3">
            <label v-for="score in [1, 2, 3, 4, 5]" :key="score" class="flex flex-col items-center">
              <input type="radio" :name="'q' + idx" :value="score" v-model="answers4[idx]" class="peer hidden" />
              <span class="w-5 h-5 rounded-full border-2 border-blue-400 flex items-center justify-center transition peer-checked:bg-blue-500 peer-checked:border-blue-500 peer-checked:scale-110 cursor-pointer">
                <span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition"></span>
              </span>
              <span class="text-xs mt-1 md:text-sm">{{ score }}</span>
            </label>
          </div>
        </div>
      </div>
      <div class="mt-5 flex justify-between w-full max-w-xl">
        <button @click="setActive(3)" class="p-1 w-20 rounded ring-2">ì´ì „</button>
        <button @click="setActive(5)" class="p-1 w-20 rounded ring-2">ë‹¤ìŒ</button>
      </div>
    </section>

    <!-- 5ë²ˆ í˜ì´ì§€ -->
    <section v-if="pageIndex === 5" class="flex flex-col justify-center items-center min-h-[80vh] px-5 md:px-7 mt-5">
      <div class="w-full max-w-xl space-y-4">
        <div v-for="(question, idx) in fivequestions" :key="idx" class="flex items-center justify-between border-b border-zinc-600 py-3">
          <span class="text-base md:text-lg"> {{ idx + 1 }}. {{ question.text }} </span>
          <div class="flex gap-2 md:gap-3">
            <label v-for="score in [1, 2, 3, 4, 5]" :key="score" class="flex flex-col items-center">
              <input type="radio" :name="'q' + idx" :value="score" v-model="answers5[idx]" class="peer hidden" />
              <span class="w-5 h-5 rounded-full border-2 border-blue-400 flex items-center justify-center transition peer-checked:bg-blue-500 peer-checked:border-blue-500 peer-checked:scale-110 cursor-pointer">
                <span class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-white opacity-0 peer-checked:opacity-100 transition"></span>
              </span>
              <span class="text-xs mt-1 md:text-sm">{{ score }}</span>
            </label>
          </div>
        </div>
      </div>
      <div class="mt-5 flex justify-between w-full max-w-xl">
        <button @click="setActive(4)" class="p-1 w-20 rounded ring-2">ì´ì „</button>
        <button @click="setActive(6)" class="p-1 w-20 rounded ring-2">ë‹¤ìŒ</button>
      </div>
    </section>

    <section v-if="pageIndex === 6" class="flex flex-col justify-center items-center min-h-[80vh] mt-5 px-2 md:px-7 py-8">
      <!-- ê²°ê³¼ ì¹´ë“œ -->
      <div class="w-full max-w-xl p-6 md:p-10 flex flex-col gap-8">
        <!-- ë‚˜ì˜ ë©”ì´íŠ¸ í‘œì‹œ -->
        <div class="flex flex-col items-center gap-2">
          <div class="text-lg md:text-xl font-semibold text-zinc-300 tracking-wide mb-2"><span class="inline-block animate-bounce">ğŸ‰</span> ë‚˜ì˜ ì†Œìš¸ ë©”ì´íŠ¸ëŠ”</div>
          <div class="text-3xl md:text-4xl font-extrabold px-4 py-2 rounded-xl text-blue-400">
            {{ mateName }}
          </div>
        </div>

        <!-- ë©¤ë²„ë³„ ì ìˆ˜ ë° ê²Œì´ì§€ -->
        <div class="flex flex-col gap-4">
          <div v-for="(name, idx) in memberNames" :key="name" class="flex items-center gap-3 md:gap-5">
            <span class="w-14 md:w-20 font-bold text-base md:text-lg text-zinc-200 text-right">
              {{ name }}
            </span>
            <div class="flex-1 flex items-center">
              <div class="relative w-full h-5 md:h-7 bg-zinc-700 rounded-lg overflow-hidden shadow-inner">
                <div class="h-full rounded-lg transition-all duration-500" :class="['bg-gradient-to-r', idx === 0 ? 'from-zinc-700 to-zinc-900' : idx === 1 ? 'from-sky-400 to-sky-600' : idx === 2 ? 'from-red-400 to-red-600' : idx === 3 ? 'from-gray-100 to-gray-400' : 'from-pink-400 to-pink-600']" :style="{ width: memberPercents[idx] + '%' }"></div>
                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs md:text-base font-bold text-white drop-shadow"> {{ memberPercents[idx] }}% </span>
              </div>
            </div>
          </div>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="flex justify-center mt-4">
          <button @click="Refresh" class="px-6 py-2 rounded-lg border border-white text-white font-bold">í˜„ì‹¤ë¶€ì •</button>
        </div>
      </div>
    </section>
  </section>
</template>
